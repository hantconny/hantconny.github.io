<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Will&#39;s thoughts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Will&#39;s thoughts">
<meta property="og:url" content="http://hantconny.github.io/index.html">
<meta property="og:site_name" content="Will&#39;s thoughts">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="从前有个包子他睡着了">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Will's thoughts" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Will&#39;s thoughts</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://hantconny.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2023-10-19-scrapy-stuff" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/19/2023-10-19-scrapy-stuff/" class="article-date">
  <time class="dt-published" datetime="2023-10-19T07:08:09.000Z" itemprop="datePublished">2023-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/19/2023-10-19-scrapy-stuff/">Scrapy</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install scrapy -i https://mirrors.ustc.edu.cn/pypi/web/simple</span></span><br></pre></td></tr></table></figure>

<p>pip install时，如果要临时切换为国内镜像，可以使用<code>-i</code>指定国内镜像地址</p>
<p>常用的国内镜像地址：</p>
<p>中科大：<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/pypi/web/simple">https://mirrors.ustc.edu.cn/pypi/web/simple</a></p>
<p>清华：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/">https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/</a></p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scrapy -v</span><br><span class="line">Scrapy 2.11.0 - no active project</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  scrapy &lt;command&gt; [options] [args]</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line">  bench         Run quick benchmark test</span><br><span class="line">  fetch         Fetch a URL using the Scrapy downloader</span><br><span class="line">  genspider     Generate new spider using pre-defined templates</span><br><span class="line">  runspider     Run a self-contained spider (without creating a project)</span><br><span class="line">  settings      Get settings values</span><br><span class="line">  shell         Interactive scraping console</span><br><span class="line">  startproject  Create new project</span><br><span class="line">  version       Print Scrapy version</span><br><span class="line">  view          Open URL in browser, as seen by Scrapy</span><br><span class="line"></span><br><span class="line">  [ more ]      More commands available when run from project directory</span><br><span class="line"></span><br><span class="line">Use &quot;scrapy &lt;command&gt; -h&quot; to see more info about a command</span><br></pre></td></tr></table></figure>

<p>可以看到，如果在scrapy项目内运行的话，还有更多的命令可用。</p>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">scrapy startproject fz_spider</span></span><br></pre></td></tr></table></figure>

<p>项目结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fz_spider/</span><br><span class="line">├── __init__.py</span><br><span class="line">├── items.py</span><br><span class="line">├── middlewares.py</span><br><span class="line">├── pipelines.py</span><br><span class="line">├── settings.py</span><br><span class="line">└── spiders</span><br><span class="line">    └── __init__.py</span><br><span class="line">└── scrapy.cfg </span><br></pre></td></tr></table></figure>

<p>在fz_spider目录下重新运行<code>scrapy -h</code>，会看到更多可用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">scrapy -h</span></span><br><span class="line">Scrapy 2.11.0 - active project: fz_spider</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  scrapy &lt;command&gt; [options] [args]</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line">  bench         Run quick benchmark test</span><br><span class="line">  check         Check spider contracts</span><br><span class="line">  crawl         Run a spider</span><br><span class="line">  edit          Edit spider</span><br><span class="line">  fetch         Fetch a URL using the Scrapy downloader</span><br><span class="line">  genspider     Generate new spider using pre-defined templates</span><br><span class="line">  list          List available spiders</span><br><span class="line">  parse         Parse URL (using its spider) and print the results</span><br><span class="line">  runspider     Run a self-contained spider (without creating a project)</span><br><span class="line">  settings      Get settings values</span><br><span class="line">  shell         Interactive scraping console</span><br><span class="line">  startproject  Create new project</span><br><span class="line">  version       Print Scrapy version</span><br><span class="line">  view          Open URL in browser, as seen by Scrapy</span><br><span class="line"></span><br><span class="line">Use &quot;scrapy &lt;command&gt; -h&quot; to see more info about a command</span><br></pre></td></tr></table></figure>

<p>这里主要关注crawl命令，通过该命令可以在命令行启动已经编写好的爬虫。</p>
<h3 id="创建爬虫"><a href="#创建爬虫" class="headerlink" title="创建爬虫"></a>创建爬虫</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">scrapy genspider fzapp <span class="string">&quot;abc.com&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>这其实创建了一个名为fzapp的爬虫，目标域名为abc.com。会在spiders目录下生成一个名为fzapp.py的文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FzappSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&quot;fzapp&quot;</span></span><br><span class="line">    allowed_domains = [<span class="string">&quot;abc.com&quot;</span>]</span><br><span class="line">    start_urls = [<span class="string">&quot;https://abc.com&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>Python的文件名和类名并没有要求一致，因此可以修改文件名，也可以修改类名。比如可以将文件名修改为fz_app.py。也可以将类名修改为FzAppSpider。</p>
<p>这个文件没什么特殊，也可以不使用genspider命令，直接创建爬虫文件，然后继承scrapy.Spider，并实现parse方法。</p>
<p>这里有三个类变量，分别是name，allowed_domains和start_urls。对我们来说，因为不是爬取固定页面，所以有用的只有name。</p>
<p>name是爬虫的名称，虽然允许修改，但修改后运行时的名称也需要相应修改。例如，如果将<code>name = &quot;fzapp&quot;</code>修改为<code>name = &quot;fz_app&quot;</code>，则运行爬虫时，需要修改为<code>scrapy crawl fz_zpp</code>。</p>
<h3 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h3><p>可以在该文件中设置日志：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOG_LEVEL = <span class="string">&quot;DEBUG&quot;</span></span><br><span class="line">LOG_FILE = <span class="string">&quot;./spider.log&quot;</span></span><br></pre></td></tr></table></figure>



<p>可以控制爬虫是否遵循目标网站的robots.txt。该文件会定义哪些资源是爬虫可爬的，哪些是不允许爬取的。默认是遵顼该约定的，当然也可以设置为False。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br></pre></td></tr></table></figure>



<p>控制并发，默认的并发是16</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONCURRENT_REQUESTS = <span class="number">32</span></span><br></pre></td></tr></table></figure>



<p>是否启用Telnet Console，不知道这个有什么用，所以就禁掉了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TELNETCONSOLE_ENABLED = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>此外，请求头DEFAULT_REQUEST_HEADERS也在这里设置。</p>
<p>控制重试。默认会进行3次重试。如果不想重试，则使用<code>RETRY_ENABLED = False</code>关闭重试。可以针对特定的HTTP响应进行重试。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RETRY_ENABLED = <span class="literal">False</span></span><br><span class="line"><span class="comment"># RETRY_TIMES = 3</span></span><br><span class="line"><span class="comment"># RETRY_HTTP_CODES = [500, 502, 503, 504, 408]</span></span><br></pre></td></tr></table></figure>



<h3 id="在PyCharm中调试"><a href="#在PyCharm中调试" class="headerlink" title="在PyCharm中调试"></a>在PyCharm中调试</h3><p>在Run&#x2F;Debug Configurations中新建一个Python的配置，将Script path设置为scrapy提供的cmdline.py，可以用everything直接搜索并复制路径。一般是<code>C:\Users\Administrator\AppData\Local\Programs\Python\Python38\Lib\site-packages\scrapy\cmdline.py</code>。将Parameters设置为crawl fz_app。</p>
<h3 id="start-requests方法"><a href="#start-requests方法" class="headerlink" title="start_requests方法"></a>start_requests方法</h3><p>我们要爬取的url并不是一个固定的url，而是包含在一个文本文件中的url列表，因此还需要实现start_requests方法。</p>
<p>该方法必须返回一个可迭代对象。该对象包含了spider用于爬取的Request。当spider启动爬取且未指定URL时，该方法被调用。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">    meta = &#123;</span><br><span class="line">        <span class="comment"># &#x27;dont_redirect&#x27;: True,</span></span><br><span class="line">        <span class="comment">## handle_httpstatus_all:True会处理所有的http status，默认只会处理200-300之间的正确响应码</span></span><br><span class="line">        <span class="string">&#x27;handle_httpstatus_all&#x27;</span>: <span class="literal">True</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;other_202309271402&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> input_data:</span><br><span class="line">        urls = input_data.readlines()</span><br><span class="line">        <span class="keyword">for</span> iurl <span class="keyword">in</span> urls:</span><br><span class="line">            <span class="keyword">yield</span> Request(url=<span class="string">&#x27;http://&#123;url&#125;&#x27;</span>.<span class="built_in">format</span>(url=iurl), callback=self.parse, meta=meta)</span><br></pre></td></tr></table></figure>

<p>Request对象有几个需要关注的keyword参数：</p>
<p>一个是url，这个很明显，就是需要爬取的URL。</p>
<p>一个是callback，它指定了回调函数为parse方法。</p>
<p>最后是meta，它指定了爬虫的一些细节，如，是否进行302重定向，是否处理所有的http status code。以处理所有http status code为例，scrapy默认只会处理状态码为200-300之间的正确响应，对于4xx和5xx的响应码会丢弃，也就不会进入parse方法。如果我们想记录那些4xx和5xx的URL，并在事后进行分析，就需要在meta中添加对应的参数配置（handle_httpstatus_all设置为True）。</p>
<h3 id="如何处理异常的请求"><a href="#如何处理异常的请求" class="headerlink" title="如何处理异常的请求"></a>如何处理异常的请求</h3><p>即使在start_requests方法中指定了处理所有响应状态，也不能保证不遗漏。当网站无法响应时，会抛出异常，这时候就不会进入spider，而需要额外的中间件进行处理。</p>
<p>可以定义一个ExceptionMiddleware，并在process_exception方法中对异常的站点进行记录：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FzRecordExceptionMiddleware</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception, spider</span>):</span><br><span class="line">        cfg = ConfigParser()</span><br><span class="line">        cfg.read(<span class="string">&#x27;config.ini&#x27;</span>)</span><br><span class="line">        _storage_root = cfg.get(<span class="string">&#x27;storage&#x27;</span>, <span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">        _storage_ex = cfg.get(<span class="string">&#x27;storage&#x27;</span>, <span class="string">&#x27;exception&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(_storage_ex):</span><br><span class="line">            os.makedirs(_storage_ex)</span><br><span class="line"></span><br><span class="line">        ex_summary_file = os.path.join(_storage_ex, <span class="string">&#x27;exception_summary&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(ex_summary_file, encoding=<span class="string">&#x27;utf-8&#x27;</span>, mode=<span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> ex_response:</span><br><span class="line">            ex_response.write(<span class="string">&#x27;|&#x27;</span>.join([request.url, exception.MESSAGE, <span class="string">&#x27;\n&#x27;</span>]))</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>要使自定义的中间件生效，还需要再settings.py中定义中间件的顺序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">   # &quot;fz_spider.middlewares.FzSpiderDownloaderMiddleware&quot;: 543,</span><br><span class="line">   &quot;fz_spider.middlewares.FzRecordExceptionMiddleware&quot;: 543,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="如何定义代理中间件"><a href="#如何定义代理中间件" class="headerlink" title="如何定义代理中间件"></a>如何定义代理中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DeepindarkHttpProxyMiddleware</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, proxy</span>):</span><br><span class="line">        self._proxy = proxy</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="keyword">return</span> cls(proxy=crawler.settings.get(<span class="string">&#x27;PROXIES&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        request.meta[<span class="string">&#x27;proxy&#x27;</span>] = self._proxy</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>在settings.py中配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="comment"># &quot;deepindark.middlewares.DeepindarkDownloaderMiddleware&quot;: 543,</span></span><br><span class="line">    <span class="comment"># 增加一个代理中间件，在该中间件中为请求设置试用HTTP代理</span></span><br><span class="line">    <span class="string">&quot;deepindark.middlewares.DeepindarkHttpProxyMiddleware&quot;</span>: <span class="number">543</span>,</span><br><span class="line">    <span class="comment"># &quot;deepindark.middlewares.DeepindarkUserAgentMiddleware&quot;: 544</span></span><br><span class="line">    <span class="string">&quot;deepindark.middlewares.BypassCloudflare&quot;</span>: <span class="number">400</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Scrapy和requests不一样，requests原生就能支持使用socks5协议进行代理，而Scrapy暂时还不支持。</p>
<h3 id="如何从settings-py中获取值"><a href="#如何从settings-py中获取值" class="headerlink" title="如何从settings.py中获取值"></a>如何从settings.py中获取值</h3><p>可以从Crawler对象和Spider对象中获取settings的值。在中间件中，process_request，process_response方法都会提供Spider对象作为参数，此时就可以从Spider对象中获取settings.py中的配置项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spider.settings.get(<span class="string">&#x27;PROXIES&#x27;</span>)</span><br><span class="line">spider.settings[<span class="string">&#x27;PROXIES&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>而如果使用到from_crawler一类的classmethod，则会提供Crawler对象作为参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">    <span class="keyword">return</span> cls(proxy=crawler.settings.get(<span class="string">&#x27;PROXIES&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>此时可以从Crawler对象获取settings.py中的配置项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crawler.settings.get(<span class="string">&#x27;PROXIES&#x27;</span>)</span><br><span class="line">crawler.settings[<span class="string">&#x27;PROXIES&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h3 id="如何绕过Cloudflare的防封策略"><a href="#如何绕过Cloudflare的防封策略" class="headerlink" title="如何绕过Cloudflare的防封策略"></a>如何绕过Cloudflare的防封策略</h3><p>需要使用cloudscraper</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install cloudscraper -i https://mirrors.ustc.edu.cn/pypi/web/simple</span></span><br></pre></td></tr></table></figure>

<p>然后一样定义一个中间件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BypassCloudflare</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">        <span class="keyword">if</span> response.status == <span class="number">403</span>:</span><br><span class="line">            <span class="keyword">if</span> spider.name == <span class="string">&#x27;onion666&#x27;</span>:</span><br><span class="line">                url = request.url</span><br><span class="line">                rsp = spider.browser.get(url, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: spider.settings[<span class="string">&#x27;PROXIES&#x27;</span>],</span><br><span class="line">                                                       <span class="string">&#x27;https&#x27;</span>: spider.settings[<span class="string">&#x27;PROXIES&#x27;</span>]&#125;, headers=&#123;<span class="string">&#x27;referer&#x27;</span>: url&#125;)</span><br><span class="line">                <span class="keyword">return</span> HtmlResponse(url=url, body=rsp.text, encoding=<span class="string">&quot;utf-8&quot;</span>, request=request)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>因为Cloudflare会对爬虫直接返回403，所以使用状态码进行判断。随着爬取的网站变多，spider.name的判断也需要扩充。</p>
<p><code>spider.browser</code>是定义在对应爬虫中的一个变量，该变量是一个CloudScraper对象实例。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Onion666Spider</span>(scrapy.Spider):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    爬取onion666列出的所有站点</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = <span class="string">&quot;onion666&quot;</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;http://666666666tjjjeweu5iikuj7hkpke5phvdylcless7g4dn6vma2xxcad.onion/&#x27;</span>]</span><br><span class="line">    browser = cloudscraper.create_scraper()</span><br></pre></td></tr></table></figure>



<h3 id="request-meta和request-headers"><a href="#request-meta和request-headers" class="headerlink" title="request.meta和request.headers"></a>request.meta和request.headers</h3><p>meta中保存的是和Scrapy相关的内容，如：download_timeout是默认携带的，控制下载超时时间，proxy设置代理，dont_redirect控制是否允许重定向，handle_httpstatus_all控制是否处理所有的http状态码。</p>
<p>而headers保存的是和HTTP请求相关的内容，如：User-Agent设置浏览器信息从而绕过一些封堵检测，Content-Type设置允许接受什么类型的响应。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2023/10/19/2023-10-19-scrapy-stuff/" data-id="clnwufron00003ccm0zx8ewxw" data-title="Scrapy" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2023-10-19-parsing-asn-dot-one-with-java" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/" class="article-date">
  <time class="dt-published" datetime="2023-10-19T06:02:39.000Z" itemprop="datePublished">2023-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/">使用Java解析ASN.1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>ASN.1解析包含两部分，一份是定义文件，一份是数据文件。以<code>*.ASN</code>为后缀的文件是定义文件，一般为结构化的明文文本；以<code>*.dat</code>为后缀的文件是数据文件，里面的内容是编码后的数据，需要解析后才能识别。</p>
<ul>
<li><code>*.ASN</code>文件样例</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">-- ASN.1 Formal Description</span><br><span class="line">HMSC DEFINITIONS IMPLICIT TAGS ::=</span><br><span class="line">BEGIN</span><br><span class="line">Chargingdatarecord ::= SEQUENCE</span><br><span class="line">&#123;</span><br><span class="line">    header [0] Header,</span><br><span class="line">    sequenceCDR [1] SequenceCDR,</span><br><span class="line">    trailer [2] Trailer,</span><br><span class="line">    extension [3] Extension</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Header ::= SET</span><br><span class="line">&#123;</span><br><span class="line">    headerTimeStamp [0] HeaderTimeStamp,</span><br><span class="line">    recordingEntity [1] RecordingEntity,</span><br><span class="line">    extensions [2] Extensions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HeaderTimeStamp ::= TimeStamp</span><br><span class="line"></span><br><span class="line">SequenceCDR ::= SEQUENCE OF CDR</span><br><span class="line"></span><br><span class="line">CDR ::= CHOICE</span><br><span class="line">&#123;</span><br><span class="line">    mobileOriginated              [0]            MobileOriginated           ,</span><br><span class="line">    callForwarding                [100]          CallForwarding             ,</span><br><span class="line">    mobileTerminated              [1]            MobileTerminated           ,</span><br><span class="line">    roamingRecord                 [2]            RoamingRecord              ,</span><br><span class="line">    incomingGatewayRecord         [3]            IncomingGatewayRecord      ,</span><br><span class="line">    outgoingGatewayRecord         [4]            OutgoingGatewayRecord      ,</span><br><span class="line">    transit                       [5]            Transit                    ,</span><br><span class="line">    sMSMobileOriginated           [6]            SMSMobileOriginated        ,</span><br><span class="line">    sMSMobileTerminated           [7]            SMSMobileTerminated        ,</span><br><span class="line">    lCSMTRecord                   [17]           LCSMTRecord                ,</span><br><span class="line">    lCSMORecord                   [18]           LCSMORecord                ,</span><br><span class="line">    lCSNIRecord                   [19]           LCSNIRecord                ,</span><br><span class="line">    supplementaryService          [10]           SupplementaryService       ,</span><br><span class="line">    hLRInterrogation              [11]           HLRInterrogation           ,</span><br><span class="line">    commonEquipmentUsageRecord    [14]           CommonEquipmentUsageRecord ,</span><br><span class="line">    terminatingCAMEL              [16]           TerminatingCAMEL           ,</span><br><span class="line">    locationUpdate                [13]           LocationUpdate    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>*.dat</code>文件样例</li>
</ul>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722134144587.png" alt="image-20220722134144587"></p>
<ul>
<li><code>*.dat</code>文件16进制样例</li>
</ul>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722134209068.png" alt="image-20220722134209068"></p>
<p>使用Java解析ASN.1需要使用一些第三方的工具，如asn1bean，其前身是jASN1。</p>
<p>整个解析过程如下：</p>
<ol>
<li>使用定义文件生成对应的Java文件</li>
<li>读入数据文件并封装到对应的Java对象中</li>
</ol>
<h2 id="ASN-1数据类型"><a href="#ASN-1数据类型" class="headerlink" title="ASN.1数据类型"></a>ASN.1数据类型</h2><p>常见的数据类型：</p>
<table>
<thead>
<tr>
<th>ASN.1类型</th>
<th>Java类型</th>
</tr>
</thead>
<tbody><tr>
<td>OCTET STRING</td>
<td>字符串</td>
</tr>
<tr>
<td>INTEGER</td>
<td>数值</td>
</tr>
<tr>
<td>BOOLEAN</td>
<td>布尔</td>
</tr>
<tr>
<td>ENUMERATED</td>
<td>枚举</td>
</tr>
<tr>
<td>TimeStamp</td>
<td>时间戳</td>
</tr>
<tr>
<td>SET</td>
<td>对象</td>
</tr>
<tr>
<td>SEQUENCE</td>
<td>集合</td>
</tr>
</tbody></table>
<p>特例：</p>
<table>
<thead>
<tr>
<th>ASN.1类型</th>
<th>Java类型</th>
</tr>
</thead>
<tbody><tr>
<td>SEQUENCE OF CDR</td>
<td>CDR对象的集合，CDR为ASN1中的SET</td>
</tr>
<tr>
<td>NULL</td>
<td>暂时不确定的值</td>
</tr>
</tbody></table>
<p>ASN.1示例文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 双-作为注释</span><br><span class="line">-- ASN.1 Formal Description</span><br><span class="line">HMSC DEFINITIONS IMPLICIT TAGS ::=</span><br><span class="line">BEGIN</span><br><span class="line">-- 一般最外层类定义在最上面，Chargingdatarecord的类型是SEQUENCE，是ASN.1原生的集合类型</span><br><span class="line">-- ::=后面的是数据类型</span><br><span class="line">Chargingdatarecord ::= SEQUENCE</span><br><span class="line">&#123;</span><br><span class="line">    -- header的类型是Header，而Header是自定义的类型，需要自行定义</span><br><span class="line">    header      [0] Header,</span><br><span class="line">    -- sequenceCDR的类型是SequenceCDR，也是自定义的类型</span><br><span class="line">    sequenceCDR [1] SequenceCDR,</span><br><span class="line">	-- Trailer和Extension也一样，都是自定义的类型</span><br><span class="line">	trailer     [2] Trailer,</span><br><span class="line">    extension   [3] Extension</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-- HeaderTimeStamp的类型是TimeStamp，是ASN.1原生的时间戳类型</span><br><span class="line">HeaderTimeStamp ::= TimeStamp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- Header的类型是SET，是ASN.1原生的对象类型</span><br><span class="line">Header ::= SET</span><br><span class="line">&#123;</span><br><span class="line">    headerTimeStamp [0] HeaderTimeStamp,</span><br><span class="line">    recordingEntity [1] RecordingEntity,</span><br><span class="line">    extensions      [2] Extensions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- SequenceCDR的类型是SEQUENCE OF CDR，首先是一个SEQUENCE集合，其次是CDR类型的集合</span><br><span class="line">SequenceCDR ::= SEQUENCE OF CDR</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- CHOICE表明CDR类中都有哪些类型</span><br><span class="line">-- 本案中使用到的，如mobileOriginated，mobileTerminated，transit，sMSMobileOriginated，sMSMobileTerminated等</span><br><span class="line">CDR ::= CHOICE</span><br><span class="line">&#123;</span><br><span class="line">    mobileOriginated            [0]            MobileOriginated,</span><br><span class="line">    -- tag的顺序编号无所谓，不影响Java代码生成和解析</span><br><span class="line">    callForwarding              [100]          CallForwarding,</span><br><span class="line">    mobileTerminated            [1]            MobileTerminated,</span><br><span class="line">    roamingRecord               [2]            RoamingRecord,</span><br><span class="line">    incomingGatewayRecord       [3]            IncomingGatewayRecord,</span><br><span class="line">    outgoingGatewayRecord       [4]            OutgoingGatewayRecord,</span><br><span class="line">    transit                     [5]            Transit,</span><br><span class="line">    sMSMobileOriginated         [6]            SMSMobileOriginated,</span><br><span class="line">    sMSMobileTerminated         [7]            SMSMobileTerminated,</span><br><span class="line">    lCSMTRecord                 [17]           LCSMTRecord,</span><br><span class="line">    lCSMORecord                 [18]           LCSMORecord,</span><br><span class="line">    lCSNIRecord                 [19]           LCSNIRecord,</span><br><span class="line">    supplementaryService        [10]           SupplementaryService,</span><br><span class="line">    hLRInterrogation            [11]           HLRInterrogation,</span><br><span class="line">    commonEquipmentUsageRecord  [14]           CommonEquipmentUsageRecord,</span><br><span class="line">    terminatingCAMEL            [16]           TerminatingCAMEL,</span><br><span class="line">    locationUpdate              [13]           LocationUpdate    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 有些字段在生成Java文件时提示缺少该类的定义，那么可以先定义为NULL，后面如果确实需要使用，再根据华为的文档去补充。</span><br><span class="line">VasType     ::= NULL</span><br><span class="line">WpsCallFlag ::= NULL</span><br><span class="line">LRNSource   ::= NULL</span><br><span class="line">DrcCallRN   ::= NULL</span><br><span class="line">DrcCallId   ::= NULL</span><br></pre></td></tr></table></figure>



<h2 id="asn1bean工具"><a href="#asn1bean工具" class="headerlink" title="asn1bean工具"></a>asn1bean工具</h2><p>目录结构如下，省略了一些不相干的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">asb1bean</span><br><span class="line">├── bin</span><br><span class="line">│   ├── asn1bean-compiler</span><br><span class="line">│   └── asn1bean-compiler.bat</span><br><span class="line">├── build</span><br><span class="line">│   └── libs-all</span><br><span class="line">│       ├── antlr-2.7.7.jar</span><br><span class="line">│       ├── asn1bean-1.13.0.jar</span><br><span class="line">│       └── asn1bean-compiler-1.13.0.jar</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br></pre></td></tr></table></figure>

<p>.&#x2F;build&#x2F;libs-all&#x2F;下有两个jar包：</p>
<ul>
<li>asn1bean-compiler-1.13.0.jar</li>
</ul>
<p>根据定义文件生成Java文件需要该jar包，asn1bean-compiler.bat和asn1bean-compiler调用的就是这个jar包。</p>
<ul>
<li>asn1bean-1.13.0.jar</li>
</ul>
<p>生成的Java文件在编译时依赖该jar包，加入到具体项目时需要将该jar包添加到pom中。里面定义了一些依赖，如BerTag等。</p>
<p>使用asn1bean-compiler.bat或asn1bean-compiler就可以根据定义文件生成Java文件，指令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## -f 参数指定定义文件</span></span><br><span class="line"><span class="comment">## -p 文件指定生成Java文件的package名</span></span><br><span class="line">$ asn1bean-compiler.bat -f <span class="string">&quot;&lt;ASN_FILE_LOCATION&gt;&quot;</span> -p <span class="string">&quot;&lt;JAVA_PACKAGE_NAME&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ asn1bean-compiler.bat -f <span class="string">&quot;C:\Users\Administrator\Desktop\Zamtel_HW_Msc\2021-01-01\HuaweiMSC_V1_RX.ASN.modified&quot;</span> -p <span class="string">&quot;com.sinovatio.shark.bean.asn1.zamtel&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="生成Java文件"><a href="#生成Java文件" class="headerlink" title="生成Java文件"></a>生成Java文件</h2><p>根据定义文件生成Java文件的过程中会出现一些错误，常见的错误原因有：注释引起的解析错误，类型定义未找到等。</p>
<h3 id="注释引起的解析错误1"><a href="#注释引起的解析错误1" class="headerlink" title="注释引起的解析错误1"></a>注释引起的解析错误1</h3><p><strong>错误提示</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 提示1118行第37个字符有问题，遇到了非预期的&#x27;-&#x27;</span></span><br><span class="line">Generated code will be saved <span class="keyword">in</span> ./</span><br><span class="line">Parsing <span class="string">&quot;C:\Users\Administrator\Desktop\Zamtel_HW_Msc\2021-01-01\HuaweiMSC_V1_RX.ASN.original&quot;</span></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> line 1118:37: unexpected char: <span class="string">&#x27;-&#x27;</span></span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNLexer.nextToken(ASNLexer.java:334)</span><br><span class="line">        at antlr.TokenBuffer.fill(TokenBuffer.java:69)</span><br><span class="line">        at antlr.TokenBuffer.LA(TokenBuffer.java:80)</span><br><span class="line">        at antlr.LLkParser.LA(LLkParser.java:52)</span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNParser.module_body(ASNParser.java:301)</span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNParser.module_definition(ASNParser.java:182)</span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNParser.module_definitions(ASNParser.java:58)</span><br><span class="line">        at com.beanit.asn1bean.compiler.Compiler.getJavaModelFromAsn1File(Compiler.java:129)</span><br><span class="line">        at com.beanit.asn1bean.compiler.Compiler.main(Compiler.java:106)</span><br></pre></td></tr></table></figure>

<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722141017580.png" alt="image-20220722141017580"></p>
<p><strong>解决方案</strong>：</p>
<p>根据ASN.1的规范，注释以<code>--</code>开头，以<code>--</code>或行结束符结尾，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- this is comments end with double dash --</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- this is comments end with crlf</span><br></pre></td></tr></table></figure>

<p>错误的原因是LEAF NODES前面的<code>-</code>有37个，没有成对出现，所以解析报错。而实际操作中，即使<code>-</code>成对出现，有的也会提示其他错误，如花括号不匹配，缺少END标记等。所以简单粗暴且一劳永逸的解决方法是删除注释。这里应该也有asn1bean工具解析的问题。</p>
<h3 id="注释引起的解析错误2"><a href="#注释引起的解析错误2" class="headerlink" title="注释引起的解析错误2"></a>注释引起的解析错误2</h3><p><strong>错误提示</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 提示1500行第90个字符有非预期的&#x27;*&#x27;</span></span><br><span class="line">Generated code will be saved <span class="keyword">in</span> ./</span><br><span class="line">Parsing <span class="string">&quot;C:\Users\Administrator\Desktop\Zamtel_HW_Msc\2021-01-01\HuaweiMSC_V1_RX.ASN.demo&quot;</span></span><br><span class="line">line 1500:67: expecting <span class="string">&quot;END&quot;</span>, found <span class="string">&#x27;SEQUENCE&#x27;</span></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> line 1500:90: unexpected char: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNLexer.nextToken(ASNLexer.java:334)</span><br><span class="line">        at antlr.TokenBuffer.fill(TokenBuffer.java:69)</span><br><span class="line">        at antlr.TokenBuffer.LA(TokenBuffer.java:80)</span><br><span class="line">        at antlr.LLkParser.LA(LLkParser.java:52)</span><br><span class="line">        at antlr.Parser.consumeUntil(Parser.java:149)</span><br><span class="line">        at antlr.Parser.recover(Parser.java:312)</span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNParser.module_definition(ASNParser.java:188)</span><br><span class="line">        at com.beanit.asn1bean.compiler.parser.ASNParser.module_definitions(ASNParser.java:58)</span><br><span class="line">        at com.beanit.asn1bean.compiler.Compiler.getJavaModelFromAsn1File(Compiler.java:129)</span><br><span class="line">        at com.beanit.asn1bean.compiler.Compiler.main(Compiler.java:106)</span><br></pre></td></tr></table></figure>

<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722141434129.png" alt="image-20220722141434129"></p>
<p><strong>解决方案</strong>：</p>
<p>虽然报错信息提示是<code>*</code>号，但这里依然是注释引起的问题。可以将该行注释删除。</p>
<h3 id="类型定义未找到"><a href="#类型定义未找到" class="headerlink" title="类型定义未找到"></a>类型定义未找到</h3><p><strong>错误提示</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 类型定义MlcNumber没有找到</span></span><br><span class="line">Generated code will be saved <span class="keyword">in</span> ./</span><br><span class="line">Parsing <span class="string">&quot;C:\Users\Administrator\Desktop\Zamtel_HW_Msc\2021-01-01\HuaweiMSC_V1_RX.ASN.demo&quot;</span></span><br><span class="line">Generating classes <span class="keyword">for</span> module <span class="string">&quot;HMSC&quot;</span></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> java.lang.IllegalStateException: Type definition <span class="string">&quot;MlcNumber&quot;</span> was not found <span class="keyword">in</span> module <span class="string">&quot;HMSC&quot;</span></span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.followAndGetNextTaggedOrUniversalType(BerClassWriter.java:2460)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.followAndGetNextTaggedOrUniversalType(BerClassWriter.java:2436)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.followAndGetNextTaggedOrUniversalType(BerClassWriter.java:2404)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.followAndGetNextTaggedOrUniversalType(BerClassWriter.java:2393)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.isDirectAnyOrChoice(BerClassWriter.java:2478)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.getTag(BerClassWriter.java:465)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.writeSequenceOrSetEncodeFunction(BerClassWriter.java:1259)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.writeSequenceOrSetClass(BerClassWriter.java:839)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.writeConstructedTypeClass(BerClassWriter.java:536)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.translateModule(BerClassWriter.java:236)</span><br><span class="line">        at com.beanit.asn1bean.compiler.BerClassWriter.translate(BerClassWriter.java:176)</span><br><span class="line">        at com.beanit.asn1bean.compiler.Compiler.main(Compiler.java:119)</span><br></pre></td></tr></table></figure>

<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722141739266.png" alt="image-20220722141739266"></p>
<p>可以看到在定义文件中只有类型的引用而没有定义。</p>
<p><strong>解决方案</strong>：</p>
<p>只看到使用，没有看到定义。可以暂时定义为NULL，再生成Java试试，如果不报错就继续，如果依然报错，则需要参考华为的文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MlcNumber ::= NULL</span><br></pre></td></tr></table></figure>

<h3 id="成功提示"><a href="#成功提示" class="headerlink" title="成功提示"></a>成功提示</h3><p>定义文件全部修改完成后，生成Java代码不报错即表示成功。可以在bin目录下看到对应的Java文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Generated code will be saved <span class="keyword">in</span> ./</span><br><span class="line">Parsing <span class="string">&quot;C:\Users\Administrator\Desktop\Zamtel_HW_Msc\2021-01-01\HuaweiMSC_V1_RX.ASN.demo&quot;</span></span><br><span class="line">Generating classes <span class="keyword">for</span> module <span class="string">&quot;HMSC&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>



<h2 id="处理编译错误"><a href="#处理编译错误" class="headerlink" title="处理编译错误"></a>处理编译错误</h2><p>生成的Java文件并不能直接使用，里面有一些编译错误需要修改。常见错误如类名和文件名不一致，字段定义重复等。这些错误与定义文件有关，一般修改定义文件后重新生成Java文件即可。也可以在生成的Java文件中直接重构。推荐修改定义文件后重新生成Java文件。</p>
<h3 id="类名与文件名不一致"><a href="#类名与文件名不一致" class="headerlink" title="类名与文件名不一致"></a>类名与文件名不一致</h3><p><strong>错误提示</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722092908565.png" alt="image-20220722092908565"></p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722092956962.png" alt="image-20220722092956962"></p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722093023493.png" alt="image-20220722093023493"></p>
<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722142002679.png" alt="image-20220722142002679"></p>
<p><strong>解决方案</strong>：</p>
<p>类型定义只有全大写的VATTYPE定义，但使用时引用了VasType定义。为了更符合Java的命名规范，可以将大写的VASTYPE定义修改为VasType。</p>
<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722142400290.png" alt="image-20220722142400290"></p>
<p>定义文件中既有对Portedflag的定义，也有对PortedFlag的定义。PortedFlag定义为ENUMERATED，Portedflag定义为INTEGER。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722142512977.png" alt="image-20220722142512977"></p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722142542092.png" alt="image-20220722142542092"></p>
<p><strong>解决方案</strong>：</p>
<p>显然PortedFlag的定义值覆盖了Portedflag，所以保留PortedFlag，并将所有引用修改为PortedFlag。</p>
<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722142742407.png" alt="image-20220722142742407"></p>
<p><strong>解决方案</strong>：</p>
<p>SSCode和SsCode都是OCTET STRING，保留更符合Java命名规范的SsCode，并修改所有的引用。</p>
<h3 id="字段定义重复"><a href="#字段定义重复" class="headerlink" title="字段定义重复"></a>字段定义重复</h3><p><strong>错误提示</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722093901629.png" alt="image-20220722093901629"></p>
<p>此类型的错误一般是由于定义文件错误而产生的，可以修改定义文件后重新生成Java文件。</p>
<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722143130451.png" alt="image-20220722143130451"></p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722143345046.png" alt="image-20220722143345046"></p>
<p>可以看到MobileOriginated类型中定义了两个translateNumber字段，Tag Number分别是6和245。</p>
<p>Tag Number为245的还有一个字段mctType，显然应该去掉Tag Number为245的translateNumber。</p>
<h2 id="处理运行时错误"><a href="#处理运行时错误" class="headerlink" title="处理运行时错误"></a>处理运行时错误</h2><p>编译错误处理完以后就可以开始尝试解析数据文件，解析过程中还会有错误需要处理。常见错误是缺少字段定义，或字段定义类型与实际数据不匹配。可以根据错误提示补充或修正定义文件，并重新生成Java文件。</p>
<p>替换时要注意根据实际情况选择手动替换不一致的行，或替换整个文件，有时整个文件替换会覆盖已经修改好的内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.sinovatio.hmsc.CDR;</span><br><span class="line"><span class="keyword">import</span> com.sinovatio.hmsc.Chargingdatarecord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* decode.java示例 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Decode</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\Administrator\\Desktop\\Zamtel_HW_Msc\\0721\\H20220719876783.dat&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));) &#123;</span><br><span class="line">            <span class="type">Chargingdatarecord</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chargingdatarecord</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> c.decode(is);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (CDR cdr : c.getSequenceCDR().getCDR()) &#123;</span><br><span class="line">                System.out.println(cdr.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类型错误"><a href="#类型错误" class="headerlink" title="类型错误"></a>类型错误</h3><p><strong>错误提示</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722095507894.png" alt="image-20220722095507894"></p>
<p>这里需要关注几个信息：</p>
<ul>
<li><p>primitive: 32</p>
</li>
<li><p>tag number: 2</p>
</li>
<li><p>Header.java</p>
</li>
</ul>
<p>说明是Header类中Tag Number为2的字段有问题，传入的类型是32，一般是传入的类型与定义类型不一致。</p>
<p>根据BerTag可以看到，32是CONSTRUCTED，对应ASN.1的SET。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722095828313.png" alt="image-20220722095828313"></p>
<p>debug可以看到，实际期望的类型是Berg.PRIMITIVE，值为0，而传入的值为32，所以问题是定义和实际数据对不上，那以数据文件为准，修改定义。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722095926071.png" alt="image-20220722095926071"></p>
<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722100057076.png" alt="image-20220722100057076"></p>
<p>Header中Tag Number为2的字段是Extensions类型，找下Extensions类型定义，可以看到被定义为NULL。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722144721192.png" alt="image-20220722144721192"></p>
<p>修改成SET并重新生成Java文件</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722100549093.png" alt="image-20220722100549093"></p>
<h3 id="字段未定义"><a href="#字段未定义" class="headerlink" title="字段未定义"></a>字段未定义</h3><p><strong>错误提示</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722101048043.png" alt="image-20220722101048043"></p>
<p>一样的排查方法，Transit类，Tag Number为160，传入类型为0。</p>
<p><strong>定义文件</strong>：</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722145106378.png" alt="image-20220722145106378"></p>
<p>查看定义文件，发现Transit类中没有对Tag Number为160的字段进行定义。</p>
<p>根据华为文档，可以看到Tag Number 159是rateIndication，160应该紧随其后，文档中rateIndication的Tag值为0x9F 81 1F，那Tag Number 160的Tag值应该是0x9F 81 20，对应字段roamingNumber。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722145416807.png" alt="image-20220722145416807"></p>
<p>roamingNumber的类型为ADDRESS，在定义文件中搜索ADDRESS相关的类型。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722145533160.png" alt="image-20220722145533160"></p>
<p>发现有ExternalAddress和AddressString两种，而ExternalAddress最终也指向AddressString，所以先将roamingNumber的类型定义为AddressString。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722145820023.png" alt="image-20220722145820023"></p>
<p>类似的错误，基本都是定义文件中缺少相关字段，可以对照华为文档补上。</p>
<h3 id="类型错误2"><a href="#类型错误2" class="headerlink" title="类型错误2"></a>类型错误2</h3><p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722110912075.png" alt="image-20220722110912075"></p>
<p>第一个类型错误中，临时将Extensions定义为一个不包含任何字段的SET，目前看还是不对。由于华为的文档里也没有描述，只能从命名猜测Extensions为Extension的集合，参考最一开始将SequenceCDR定义为SEQUENCE OF CDR，这里也可以将Extensions定义为SEQUENCE OF Extension。修改定义后重新生成Java文件即可正常解析数据文件。</p>
<p><img src="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/image-20220722111541552.png" alt="image-20220722111541552"></p>
<h2 id="测试数据文件"><a href="#测试数据文件" class="headerlink" title="测试数据文件"></a>测试数据文件</h2><p>如果不确定数据文件是否正确，可以先从数据文件dump一个结构文件出来看下，一般数据文件没有问题，都可以正常dump出一个结构文件。如果像赞比亚刚开始数据文件错误，那dump时会报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.asn1.ASN1InputStream;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.asn1.ASN1Primitive;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.asn1.util.ASN1Dump;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dump</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">asnFilePath</span> <span class="operator">=</span> <span class="string">&quot;C:\\Users\\Administrator\\Desktop\\Zamtel_HW_Msc\\0721\\H20220719876780.dat&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">outputStrucAndDataFilePath</span> <span class="operator">=</span> asnFilePath + <span class="string">&quot;.dump&quot;</span>;</span><br><span class="line">        <span class="type">ASN1InputStream</span> <span class="variable">ais</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ASN1InputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(asnFilePath)));</span><br><span class="line">        <span class="keyword">while</span> (ais.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ASN1Primitive</span> <span class="variable">obj</span> <span class="operator">=</span> ais.readObject();</span><br><span class="line">            FileUtil.writeUtf8String(ASN1Dump.dumpAsString(obj, <span class="literal">true</span>), <span class="keyword">new</span> <span class="title class_">File</span>(outputStrucAndDataFilePath));</span><br><span class="line">        &#125;</span><br><span class="line">        ais.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dump需要额外的依赖，artifactId名称需要根据jdk版本来确定，JDK1.8使用bcprov-jdk18on，可以在 <a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven Repository</a> 里搜索。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk18on<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.71<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><p>正常项目只需要加入以下依赖即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.beanit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asn1bean<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.beanit.com/asn1/">https://www.beanit.com/asn1/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/beanit/asn1bean">https://github.com/beanit/asn1bean</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/" data-id="clnws9udn0000kwcmh9k5er2s" data-title="使用Java解析ASN.1" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ASN-1/" rel="tag">ASN.1</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2014-03-29-plsqldeveloper-to-connect-to-remote-oracle" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/" class="article-date">
  <time class="dt-published" datetime="2014-03-28T16:00:00.000Z" itemprop="datePublished">2014-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/onenote/">onenote</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/">PLSQL Developer安装及配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="安装PLSQL-Developer"><a href="#安装PLSQL-Developer" class="headerlink" title="安装PLSQL Developer"></a>安装PLSQL Developer</h3><p>可以直接从allroundautomations的网站<a target="_blank" rel="noopener" href="http://www.allroundautomations.com/plsqldev.html">下载PLSQL Developer</a>，双击安装即可。</p>
<p>假定PLSQL Developer的安装目录为<code>C:\Program Files (x86)\PLSQL Developer</code>，本文其余内容均以<code>$PLSQL_HOME</code>来指代该路径。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/plsql-alert-info.jpg" alt="PLSQL Developer提示信息"></p>
<p>值得注意的是，在安装PLSQL Developer时，如果路径中带有括号，会提示你确认PLSQL Developer将来连接的Oracle版本必须是11g及以后版本。</p>
<h3 id="解压Oracle-Instant-Client"><a href="#解压Oracle-Instant-Client" class="headerlink" title="解压Oracle Instant Client"></a>解压Oracle Instant Client</h3><p>从Oracle的网站<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html">下载Instant Client</a>，并解压到本地目录。为了方便携带PLSQL Developer，可以直接解压到<code>$PLSQL_HOME\instantclient_11_2</code>，本文其余内容均以<code>$INSTANTCLIENT_HOME</code>指代该路径。</p>
<p>值得注意的是，即使是在64位的操作系统，也应该选择32位的Instant Client。</p>
<p>在<code>$INSTANTCLIENT_HOME</code>下建立<code>\NETWORK\ADMIN</code>的目录结构，然后将Oracle的<code>tnsnames.ora</code>文件拷贝进来。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/instant-client-structure.jpg" alt="Instant Client结构"></p>
<h3 id="配置PLSQL-Developer"><a href="#配置PLSQL-Developer" class="headerlink" title="配置PLSQL Developer"></a>配置PLSQL Developer</h3><p>首次启动PLSQL Developer时，因为没有进行配置，所以没法登录。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/plsql-login.jpg" alt="PLSQL Developer登录窗口"></p>
<p>点击Cancel进入PLSQL Developer后，依次点击<em>Tools &gt; Preferences</em>，设置好<em>Oracle Home</em>和<em>OCI library</em>，并且选中<em>Check connection</em>，确认后退出PLSQL Developer。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/plsql-setting.jpg" alt="PLSQL Developer设置页面"></p>
<p>重启PLSQL Developer，会发现在Database中已经可以看到tnsnames.ora中的信息了。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/configured-login.jpg" alt="PLSQL Developer配置后的登录窗口"></p>
<p>填入Username和Password，应该能正常登录到远程的Oracle。</p>
<h3 id="配置Windows防火墙"><a href="#配置Windows防火墙" class="headerlink" title="配置Windows防火墙"></a>配置Windows防火墙</h3><p>有的时候，局域网内的机器A通过PLSQL Developer无法连接到机器B的Oracle，原因可能有很多，这里只说明如何配置机器B的防火墙入站规则。</p>
<p>打开防火墙的高级设置，选择<em>入站规则</em>，等待视图刷新后，点击右侧的<em>新建规则</em></p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/inbound-rule.jpg" alt="入站规则"></p>
<p>选择端口，点击下一步。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/inbound-rule-1.jpg" alt="新建入站规则 Step 1"></p>
<p>如果使用Oracle的默认端口，那么输入1521，如果自定义了Oracle的端口，输入自定义端口。</p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/inbound-rule-2.jpg" alt="新建入站规则 Step 2"></p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/inbound-rule-3.jpg" alt="新建入站规则 Step 3"></p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/inbound-rule-4.jpg" alt="新建入站规则 Step 4"></p>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/inbound-rule-5.jpg" alt="新建入站规则 Step 5"></p>
<p>配置完成后，可以在机器A上使用<code>telnet IP port</code>进行测试</p>
<h4 id="其他PLSQL-Developer配置"><a href="#其他PLSQL-Developer配置" class="headerlink" title="其他PLSQL Developer配置"></a>其他PLSQL Developer配置</h4><ul>
<li>自动大写</li>
</ul>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/uppercase.jpg" alt="自动大写"></p>
<ul>
<li>单行执行</li>
</ul>
<p><img src="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/single-row.jpg" alt="单行执行"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/" data-id="clmj3ayeo00256scmh91ad9k7" data-title="PLSQL Developer安装及配置" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PLSQL-Developer/" rel="tag">PLSQL Developer</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-09-20-wedding-blessing" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/09/20/2013-09-20-wedding-blessing/" class="article-date">
  <time class="dt-published" datetime="2013-09-19T16:00:00.000Z" itemprop="datePublished">2013-09-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E5%BF%B5/">杂念</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/09/20/2013-09-20-wedding-blessing/">Wedding Blessing</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>同学结婚，新郎新娘都是大学同窗。</p>
<p>坐了三个小时的长途车，从南京来到了传说中的“南通好家园”（其实是海安啦），不过婚礼现场也唱到这首歌，我们都笑了。</p>
<p>同学的婚礼总还是有意思的，来回的舟车劳顿也是值得的，anyway，祝福你们。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/09/20/2013-09-20-wedding-blessing/" data-id="clmj3ayds000w6scm3q5a9ozb" data-title="Wedding Blessing" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Wedding/" rel="tag">Wedding</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-08-13-new-job" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/08/13/2013-08-13-new-job/" class="article-date">
  <time class="dt-published" datetime="2013-08-12T16:00:00.000Z" itemprop="datePublished">2013-08-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E5%BF%B5/">杂念</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/08/13/2013-08-13-new-job/">新工作</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>离开特维。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/08/13/2013-08-13-new-job/" data-id="clmj3aydp000v6scm8k6vb003" data-title="新工作" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E5%BF%B5/" rel="tag">杂念</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-07-27-miss-right" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/07/27/2013-07-27-miss-right/" class="article-date">
  <time class="dt-published" datetime="2013-07-26T16:00:00.000Z" itemprop="datePublished">2013-07-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E5%BF%B5/">杂念</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/07/27/2013-07-27-miss-right/">Miss Right?</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Jul. 8, 2013</p>
<p>She might be my miss right?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/07/27/2013-07-27-miss-right/" data-id="clmj3aydw00106scm2zhe1x04" data-title="Miss Right?" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Miss-Right/" rel="tag">Miss Right?</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-06-02-enable-short-tag-in-wampserver" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/06/02/2013-06-02-enable-short-tag-in-wampserver/" class="article-date">
  <time class="dt-published" datetime="2013-06-01T16:00:00.000Z" itemprop="datePublished">2013-06-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/onenote/">onenote</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/06/02/2013-06-02-enable-short-tag-in-wampserver/">在WampServer中开启短标签</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>还是在给公司项目做选型，碰到一个用<a target="_blank" rel="noopener" href="http://twitter.github.io/bootstrap/">Bootstrap</a>作为前端框架的<a target="_blank" rel="noopener" href="http://www.startbbs.com/">StartBBS</a>，正好前段时间得空看过，所以王八看绿豆，直接对上眼了。</p>
<p>不过安装完以后就报错了，论坛里也有相同错误的求助帖，但是都没有提到解决方案，只露出一点关于PHP短标签的线索，所以按图索骥Google了一下，找到了<a target="_blank" rel="noopener" href="http://blog.gishome.org/post-9.html">解决方案</a>。</p>
<h3 id="版本及目录信息"><a href="#版本及目录信息" class="headerlink" title="版本及目录信息"></a>版本及目录信息</h3><p>OS：<code>32位 Window7 Ultimate</code></p>
<p>WampServer：<code>(32 bits &amp; PHP 5.3) 2.2E</code></p>
<p>WampServer安装目录：<code>C:\wamp</code></p>
<h3 id="修改Apache目录下的php-ini文件"><a href="#修改Apache目录下的php-ini文件" class="headerlink" title="修改Apache目录下的php.ini文件"></a>修改Apache目录下的<code>php.ini</code>文件</h3><p>路径：<code>C:\wamp\bin\apache\apache2.2.22\bin\php.ini</code></p>
<p>找到</p>
<pre><code>short_open_tag = Off
</code></pre>
<p>修改成</p>
<pre><code>short_open_tag = On
</code></pre>
<h3 id="修改PHP目录下的php-ini文件"><a href="#修改PHP目录下的php-ini文件" class="headerlink" title="修改PHP目录下的php.ini文件"></a>修改PHP目录下的<code>php.ini</code>文件</h3><p>路径：<code>C:\wamp\bin\php\php5.3.13\php.ini</code></p>
<p>找到</p>
<pre><code>short_open_tag = Off
</code></pre>
<p>修改成</p>
<pre><code>short_open_tag = On
</code></pre>
<h3 id="修改站点目录下的config-php文件"><a href="#修改站点目录下的config-php文件" class="headerlink" title="修改站点目录下的config.php文件"></a>修改站点目录下的<code>config.php</code>文件</h3><p>例如我把StartBBS安装在<code>C:\wamp\www3\</code>下，那么该<code>config.php</code>文件的路径就是<code>C:\wamp\www3\app\config\config.php</code></p>
<p>找到</p>
<pre><code>$config[&#39;rewrite_short_tags&#39;]
</code></pre>
<p>确保该配置的值是</p>
<pre><code>$config[&#39;rewrite_short_tags&#39;] = true;
</code></pre>
<p>重启WampServer即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/06/02/2013-06-02-enable-short-tag-in-wampserver/" data-id="clmj3aye300176scm103egtst" data-title="在WampServer中开启短标签" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Bootstrap/" rel="tag">Bootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WAMP/" rel="tag">WAMP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-05-31-change-cmd-path" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/05/31/2013-05-31-change-cmd-path/" class="article-date">
  <time class="dt-published" datetime="2013-05-30T16:00:00.000Z" itemprop="datePublished">2013-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/onenote/">onenote</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/05/31/2013-05-31-change-cmd-path/">更改CMD的起始路径</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>打开注册表，展开<code>HKEY_CURRENT_USER\Software\Microsoft\CommandProcessor</code>，新建一个名为AutoRun的字符串值，设置该字符串值为<code>CD /D C:\</code>，这样下次使用CMD的时候，默认路径就是C盘根目录了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/05/31/2013-05-31-change-cmd-path/" data-id="clmj3aydj000r6scm7cb15pu3" data-title="更改CMD的起始路径" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CMD/" rel="tag">CMD</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-05-30-install-phpwind" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/05/30/2013-05-30-install-phpwind/" class="article-date">
  <time class="dt-published" datetime="2013-05-29T16:00:00.000Z" itemprop="datePublished">2013-05-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/onenote/">onenote</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/05/30/2013-05-30-install-phpwind/">使用WampServer搭建WAMP环境</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="版本及目录信息"><a href="#版本及目录信息" class="headerlink" title="版本及目录信息"></a>版本及目录信息</h3><p>OS：<code>32位 Window7 Ultimate</code></p>
<p>Microsoft Visual C++：<code>2010 SP1 Redistributable Package (x86)</code></p>
<p>WampServer：<code>(32 bits &amp; PHP 5.3) 2.2E</code></p>
<p>PHPWind：<code>v9.0</code></p>
<p>WampServer安装目录：<code>C:\wamp</code></p>
<h3 id="WampServer部分"><a href="#WampServer部分" class="headerlink" title="WampServer部分"></a>WampServer部分</h3><h4 id="WampServer下载"><a href="#WampServer下载" class="headerlink" title="WampServer下载"></a>WampServer下载</h4><p>下载<a target="_blank" rel="noopener" href="http://www.wampserver.com/">WampServer</a></p>
<h4 id="WampServer安装"><a href="#WampServer安装" class="headerlink" title="WampServer安装"></a>WampServer安装</h4><p>安装Microsoft Visual C++</p>
<p>安装火狐</p>
<p>安装WampServer</p>
<h4 id="WampServer配置"><a href="#WampServer配置" class="headerlink" title="WampServer配置"></a>WampServer配置</h4><p>为了允许非本机访问，需要修改Apache和phpMyAdmin的两个配置文件。</p>
<ul>
<li>修改Apache的<code>httpd.conf</code>文件</li>
</ul>
<p>路径：<code>C:\wamp\bin\apache\apache2.2.22\conf\</code></p>
<p>找到如下代码</p>
<pre><code>&lt;Directory &quot;c:/wamp/www/&quot;&gt;
    ...省略若干注释
    #    onlineoffline tag - don&#39;t remove
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
&lt;/Directory&gt;
</code></pre>
<p>修改为</p>
<pre><code>&lt;Directory &quot;c:/wamp/www/&quot;&gt;
    ...省略若干注释
    #    onlineoffline tag - don&#39;t remove
    #    Order Deny,Allow
    #    Deny from all
    #    Allow from 127.0.0.1
    AllowOverride All
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
</code></pre>
<ul>
<li>修改phpMyAdmin的<code>phpmyadmin.conf</code>文件</li>
</ul>
<p>路径：<code>C:\wamp\alias\</code></p>
<p>找到</p>
<pre><code>&lt;Directory &quot;c:/wamp/apps/phpmyadmin3.5.1/&quot;&gt;
    #    Options Indexes FollowSymLinks MultiViews
    AllowOverride all
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
&lt;/Directory&gt;
</code></pre>
<p>修改为</p>
<pre><code>&lt;Directory &quot;c:/wamp/apps/phpmyadmin3.5.1/&quot;&gt;
    #    Options Indexes FollowSymLinks MultiViews
    #    AllowOverride all
    #    Order Deny,Allow
    #	 Deny from all
    #	 Allow from 127.0.0.1
    AllowOverride All
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
</code></pre>
<p>另外，由于WampServer默认没有设置MySQL的密码，所以还需要把MySQL的密码设置起来。</p>
<ul>
<li>设置MySQL密码</li>
</ul>
<p>在火狐中输入<code>localhost/phpmyadmin</code>进入phpMyAdmin的界面，切换到SQL页面。</p>
<p>先查询mysql.user表中关于root的信息：</p>
<pre><code>select * from mysql.user where User = &#39;root&#39;;
</code></pre>
<p>然后利用password函数加密明文密码并更新root的密码：</p>
<pre><code>update mysql.user set Password = password(&#39;ok&#39;) where User = &#39;root&#39;;
</code></pre>
<p>最后使修改生效：</p>
<pre><code>flush privileges;
</code></pre>
<p>重启WampServer</p>
<ul>
<li>设置phpMyAdmin的<code>config.inc.php</code>文件</li>
</ul>
<p>路径：<code>C:\wamp\apps\phpmyadmin3.5.1\</code></p>
<p>找到</p>
<pre><code>$cfg[&#39;Servers&#39;][$i][&#39;password&#39;] = &#39;&#39;;
</code></pre>
<p>修改为</p>
<pre><code>$cfg[&#39;Servers&#39;][$i][&#39;password&#39;] = &#39;ok&#39;;
</code></pre>
<p>重启WampServer</p>
<h3 id="PHPWind部分"><a href="#PHPWind部分" class="headerlink" title="PHPWind部分"></a>PHPWind部分</h3><h4 id="PHPWind下载"><a href="#PHPWind下载" class="headerlink" title="PHPWind下载"></a>PHPWind下载</h4><p>下载<a target="_blank" rel="noopener" href="http://www.phpwind.com/index.php?m=downloads&a=downloadsphpwind">PHPWind</a></p>
<h4 id="PHPWind安装"><a href="#PHPWind安装" class="headerlink" title="PHPWind安装"></a>PHPWind安装</h4><p>解压压缩包，并把<code>upload</code>目录下的所有内容复制到<code>C:\wamp\www\</code>目录下</p>
<pre><code>PHPWind v9.0不要复制upload\.htaccess文件
</code></pre>
<p>访问<code>localhost/install.php</code>开始安装</p>
<h3 id="PS-让Apache能部署多个项目"><a href="#PS-让Apache能部署多个项目" class="headerlink" title="PS:让Apache能部署多个项目"></a>PS:让Apache能部署多个项目</h3><p>这里因为是在给公司测试选型，所以选用同IP，不同端口这种实现方式。由于我对Apache及PHP并不熟悉，只是临时救火，所以按下不表，具体可以参见Apache<a target="_blank" rel="noopener" href="http://httpd.apache.org/docs/2.0/vhosts/examples.html">官网</a>。</p>
<ul>
<li>修改Apache的<code>httpd.conf</code>文件</li>
</ul>
<p>路径：<code>C:\wamp\bin\apache\apache2.2.22\conf\</code></p>
<p>找到</p>
<pre><code>Listen 80
</code></pre>
<p>修改为</p>
<pre><code>Listen 80
Listen 81
&lt;VirtualHost *:80&gt;   
    DocumentRoot C:/wamp/www
    ServerName phpwind
&lt;/VirtualHost&gt;   
&lt;VirtualHost *:81&gt;   
    DocumentRoot C:/wamp/www2
    ServerName ecshop
&lt;/VirtualHost&gt;
...省略若干
&lt;Directory &quot;c:/wamp/www2/&quot;&gt;
    AllowOverride All
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
</code></pre>
<p>重启WampServer即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/05/30/2013-05-30-install-phpwind/" data-id="clmj3aydn000s6scm6ggff7j0" data-title="使用WampServer搭建WAMP环境" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache/" rel="tag">Apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHPWIND/" rel="tag">PHPWIND</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WAMP/" rel="tag">WAMP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2013-05-29-copperplate" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/05/29/2013-05-29-copperplate/" class="article-date">
  <time class="dt-published" datetime="2013-05-28T16:00:00.000Z" itemprop="datePublished">2013-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E5%BF%B5/">杂念</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2013/05/29/2013-05-29-copperplate/">静心养气</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>看Downton Abbey的时候听到了双城记，于是去买了一本，还为了凑运费又多买了本悉达多和少年维特的烦恼。</p>
<p>上班对着电脑是工作需要，下班了还是该找点书看看，只当换一种消遣方式，也压一压日渐抬头的浮躁。虽然07年以后的几年里，身上一度找不到浮躁的气息，但这种与生俱来的东西并没有消失，只是蛰伏了起来，在最近2、3年又羽翼渐丰，开始不断试探。</p>
<p>既如此，那不妨看书习字，静养些时日吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hantconny.github.io/2013/05/29/2013-05-29-copperplate/" data-id="clmj3ayde000m6scm2ao01qty" data-title="静心养气" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Downton-Abbey/" rel="tag">Downton Abbey</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/onenote/">onenote</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E5%BF%B5/">杂念</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASN-1/" rel="tag">ASN.1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/" rel="tag">Apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bootstrap/" rel="tag">Bootstrap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/" rel="tag">CMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DISQUS/" rel="tag">DISQUS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Downton-Abbey/" rel="tag">Downton Abbey</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grey-s-Anatomy/" rel="tag">Grey&#39;s Anatomy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekyll/" rel="tag">Jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Liquid/" rel="tag">Liquid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Miss-Right/" rel="tag">Miss Right?</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHPWIND/" rel="tag">PHPWIND</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PLSQL-Developer/" rel="tag">PLSQL Developer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Photographic/" rel="tag">Photographic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrapy/" rel="tag">Scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tapir/" rel="tag">Tapir</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WAMP/" rel="tag">WAMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wedding/" rel="tag">Wedding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E5%BF%B5/" rel="tag">杂念</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ASN-1/" style="font-size: 10px;">ASN.1</a> <a href="/tags/Apache/" style="font-size: 10px;">Apache</a> <a href="/tags/Bootstrap/" style="font-size: 10px;">Bootstrap</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/DISQUS/" style="font-size: 10px;">DISQUS</a> <a href="/tags/Downton-Abbey/" style="font-size: 10px;">Downton Abbey</a> <a href="/tags/Grey-s-Anatomy/" style="font-size: 10px;">Grey's Anatomy</a> <a href="/tags/Jekyll/" style="font-size: 20px;">Jekyll</a> <a href="/tags/Liquid/" style="font-size: 10px;">Liquid</a> <a href="/tags/Miss-Right/" style="font-size: 10px;">Miss Right?</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/PHPWIND/" style="font-size: 10px;">PHPWIND</a> <a href="/tags/PLSQL-Developer/" style="font-size: 10px;">PLSQL Developer</a> <a href="/tags/Photographic/" style="font-size: 10px;">Photographic</a> <a href="/tags/Scrapy/" style="font-size: 10px;">Scrapy</a> <a href="/tags/Tapir/" style="font-size: 10px;">Tapir</a> <a href="/tags/WAMP/" style="font-size: 15px;">WAMP</a> <a href="/tags/Wedding/" style="font-size: 15px;">Wedding</a> <a href="/tags/%E6%9D%82%E5%BF%B5/" style="font-size: 20px;">杂念</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">六月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">六月 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/10/19/2023-10-19-scrapy-stuff/">Scrapy</a>
          </li>
        
          <li>
            <a href="/2023/10/19/2023-10-19-parsing-asn-dot-one-with-java/">使用Java解析ASN.1</a>
          </li>
        
          <li>
            <a href="/2014/03/29/2014-03-29-plsqldeveloper-to-connect-to-remote-oracle/">PLSQL Developer安装及配置</a>
          </li>
        
          <li>
            <a href="/2013/09/20/2013-09-20-wedding-blessing/">Wedding Blessing</a>
          </li>
        
          <li>
            <a href="/2013/08/13/2013-08-13-new-job/">新工作</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 从前有个包子他睡着了<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>